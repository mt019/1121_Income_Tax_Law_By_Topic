\usepackage{booktabs}
\usepackage{longtable}


\usepackage{framed,color}
\definecolor{shadecolor}{RGB}{248,248,248}

\usepackage[toc, page]{appendix} 

\renewcommand{\textfraction}{0.05}
\renewcommand{\topfraction}{0.8}
\renewcommand{\bottomfraction}{0.8}
\renewcommand{\floatpagefraction}{0.75}

\renewcommand\contentsname{目錄}
\renewcommand\listfigurename{圖目錄}
\renewcommand\listtablename{表目錄}
\renewcommand{\appendixtocname}{附錄} 
\renewcommand{\appendixpagename}{附錄} 
\newcommand{\SetNTUCJKFonts}[3]{%
  \setCJKmainfont[AutoFakeBold=2]{#1}%
  \setCJKsansfont[AutoFakeBold=2]{#2}%
  \setCJKmonofont{#3}%
  \setCJKfamilyfont{song}{#1}%
  \setCJKfamilyfont{hei}{#2}%
  \setCJKfamilyfont{kai}{#1}%
  \setCJKfamilyfont{fang}{#1}%
}

\IfFontExistsTF{Noto Serif CJK TC}{%
  \IfFontExistsTF{Noto Sans Mono CJK TC}{%
    \SetNTUCJKFonts{Noto Serif CJK TC}{Noto Sans CJK TC}{Noto Sans Mono CJK TC}%
  }{%
    \SetNTUCJKFonts{Noto Serif CJK TC}{Noto Sans CJK TC}{Noto Sans CJK TC}%
  }%
}{%
  \IfFontExistsTF{Source Han Serif TC}{%
    \SetNTUCJKFonts{Source Han Serif TC}{Source Han Sans TC}{Source Han Sans TC}%
  }{%
    \IfFontExistsTF{PingFang TC}{%
      \SetNTUCJKFonts{PingFang TC}{PingFang TC}{PingFang TC}%
    }{%
      \SetNTUCJKFonts{FandolSong-Regular}{FandolHei-Regular}{FandolHei-Regular}%
    }%
  }%
}
\ifdefined\songti
  \renewcommand{\songti}{\CJKfamily{song}}
\else
  \newcommand{\songti}{\CJKfamily{song}}
\fi
\ifdefined\heiti
  \renewcommand{\heiti}{\CJKfamily{hei}}
\else
  \newcommand{\heiti}{\CJKfamily{hei}}
\fi
\ifdefined\kaishu
  \renewcommand{\kaishu}{\CJKfamily{kai}}
\else
  \newcommand{\kaishu}{\CJKfamily{kai}}
\fi
\ifdefined\fangsong
  \renewcommand{\fangsong}{\CJKfamily{fang}}
\else
  \newcommand{\fangsong}{\CJKfamily{fang}}
\fi

\ctexset{chapter ={
  format += \bfseries\songti,
  % format += \rmfamily,
name={第,章},
number=\arabic{chapter},
},
section/format += \songti,
subsection/format += \songti,
subsubsection/format += \songti,
paragraph/format =  \large\bfseries\songti,
paragraph/numbering = true,
appendixname = {附錄}
}



% \renewcommand{\cftsecfont}{\stxs} %设置section条目的字体

\let\oldhref\href
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}

\makeatletter
\newenvironment{kframe}{%
\medskip{}
\setlength{\fboxsep}{.8em}
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\makeatletter
\@ifundefined{Shaded}{
}{\renewenvironment{Shaded}{\begin{kframe}}{\end{kframe}}}
\@ifpackageloaded{fancyvrb}{%
  % https://github.com/CTeX-org/ctex-kit/issues/331
  \RecustomVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\},formatcom=\xeCJKVerbAddon}%
}{}
\makeatother

% \usepackage{makeidx}
% \makeindex
\usepackage{imakeidx}

% \newcommand{\gobblecomma}[1]{\@gobble{#1}\ignorespaces}

\newcommand\gobbleone[1]{}
\newcommand*{\seeonly}[2]{\ (\emph{\seename} #1)}
% \newcommand*{\also}[2]{(\emph{\alsoname} #1)}
% \newcommand{\Also}[2]{\emph{See also} #1}

% \providecommand*\see[2]{\emph{\seename} #1}

% \usepackage{seealso}


% https://latex.org/forum/viewtopic.php?t=27503

\renewcommand{\seename}{參見}
\renewcommand{\alsoname}{又見}


% https://zhuanlan.zhihu.com/p/572429923


% \usepackage{hyperref}
% \usepackage{classicthesis}
% \usepackage[eulerchapternumbers,subfig,beramono,eulermath,pdfspacing,
% listings]{classicthesis}
\makeindex[intoc=true,
columns=1,columnseprule=true,
%  options=-s latex/indexstyles.ist
]

\usepackage{hyperref}

\urlstyle{tt}

\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\frontmatter
